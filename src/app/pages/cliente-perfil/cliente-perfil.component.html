<div class="perfil-container">
  <div class="header">
    <h2>Perfil de Cliente #{{id}}</h2>
    <div class="actions">
      <button class="btn" routerLink="/clientes">Volver</button>
      <button class="btn primary" (click)="toggleEdit()">{{ editMode() ? 'Cancelar edición' : 'Editar' }}</button>
      <button class="btn success" (click)="guardar()" [disabled]="!editMode()">Guardar</button>
    </div>
  </div>

  <div class="alert error" *ngIf="errorMsg()">{{errorMsg()}}</div>
  <div class="alert info" *ngIf="infoMsg()">{{infoMsg()}}</div>

  <form [formGroup]="form" class="form-grid">
    <div class="field">
      <label>Nombres</label>
      <input class="form-control" formControlName="nombres" />
    </div>
    <div class="field"><label>Apellido paterno</label><input class="form-control" formControlName="apellido_paterno" /></div>
    <div class="field"><label>Apellido materno</label><input class="form-control" formControlName="apellido_materno" /></div>
    <div class="field"><label>RFC</label><input class="form-control" formControlName="rfc" /></div>
    <div class="field"><label>CURP</label><input class="form-control" formControlName="curp" /></div>
    <div class="field"><label>Email</label><input class="form-control" formControlName="email" /></div>
    <div class="field"><label>Teléfono</label><input class="form-control" formControlName="telefono" /></div>
    <div class="field"><label>Estado</label><input class="form-control" formControlName="estado" /></div>
    <div class="field"><label>Ciudad</label><input class="form-control" formControlName="ciudad" /></div>
    <div class="field grow"><label>Dirección</label><input class="form-control" formControlName="direccion" /></div>
    <div class="field"><label>Ingresos mensuales</label><input class="form-control" formControlName="ingresos_mensuales" /></div>
  </form>

  <div style="margin-top:24px;">
  <h3>Solicitudes de Préstamo</h3>
    <div *ngIf="!(solicitudes()?.length)" class="alert info">Este cliente no tiene solicitudes registradas.</div>
    <div *ngIf="solicitudes()?.length">
      <div style="overflow:auto;">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:left; padding:6px;">ID</th>
              <th style="text-align:left; padding:6px;">Estatus</th>
              <th style="text-align:left; padding:6px;">Monto</th>
              <th style="text-align:left; padding:6px;">Plazo (meses)</th>
              <th style="text-align:left; padding:6px;">Interés mensual</th>
              <th style="text-align:left; padding:6px;">Penalización diaria</th>
              <th style="text-align:left; padding:6px;">Total estimado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of solicitudes()" style="border-top:1px solid #eee;">
              <td style="padding:6px;">{{s.id}}</td>
              <td style="padding:6px;">
                <span [ngStyle]="{padding:'2px 6px', borderRadius:'4px', backgroundColor: s.estatus==='APROBADO' ? '#d1fae5' : (s.estatus==='RECHAZADO' ? '#fee2e2' : '#e5e7eb')}" >{{s.estatus}}</span>
              </td>
              <td style="padding:6px;">${{s.monto}}</td>
              <td style="padding:6px;">{{s.plazo_meses}}</td>
              <td style="padding:6px;">{{s.interes}}%</td>
              <td style="padding:6px;">{{s.interes_penalizacion}}%/día</td>
              <td style="padding:6px;">${{ (s.monto * (1 + (s.interes/100) * s.plazo_meses)) | number:'1.2-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div *ngIf="aprobados()?.length" class="alert success" style="margin-top:12px;">
      Crédito(s) aprobado(s):
      <ul style="margin:6px 0 0 16px;">
        <li *ngFor="let a of aprobados()">#{{a.id}} - {{a.tipo_prestamo}} por ${{a.monto | number:'1.0-0'}} a {{a.plazo_meses}} meses</li>
      </ul>
    </div>
  </div>
</div>
