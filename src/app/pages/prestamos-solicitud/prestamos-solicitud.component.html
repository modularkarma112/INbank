<div class="container">
  <div class="header">
    <button class="back-button" (click)="goBack()">‚Üê</button>
    <div class="header-content">
      <div class="currency-icon">üí≤</div>
      <div class="header-text">
        <h1>Solicitud de Pr√©stamo</h1>
        <p>Buscar cliente, capturar datos y enviar a revisi√≥n</p>
      </div>
    </div>
  </div>

  <div class="form-container">
    <form (ngSubmit)="onSubmit()">
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon"><span>üîé</span></div>
          <div class="section-title">
            <h2>Buscar Cliente</h2>
            <p>Busque por ID, RFC, CURP, email o tel√©fono</p>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group"><label>Texto libre</label><input type="text" [(ngModel)]="buscarNombreLibre" name="buscar_q" placeholder="Nombre, email, tel√©fono..."/></div>
          <div class="form-group"><label>ID</label><input type="text" [(ngModel)]="buscar.id" name="buscar_id" /></div>
          <div class="form-group"><label>RFC</label><input type="text" [(ngModel)]="buscar.rfc" name="buscar_rfc" /></div>
          <div class="form-group"><label>CURP</label><input type="text" [(ngModel)]="buscar.curp" name="buscar_curp" /></div>
          <div class="form-group"><label>Email</label><input type="email" [(ngModel)]="buscar.email" name="buscar_email" /></div>
          <div class="form-group"><label>Tel√©fono</label><input type="text" [(ngModel)]="buscar.telefono" name="buscar_telefono" /></div>
        </div>
        <div class="button-group" style="justify-content:flex-start; margin-top: 10px;">
          <button type="button" class="btn btn-primary" (click)="buscarCliente()">Buscar</button>
        </div>

        <div *ngIf="resultados.length > 1" style="margin-top: 15px;">
          <div style="overflow:auto;">
            <table style="width:100%; border-collapse:collapse;">
              <thead>
                <tr>
                  <th style="text-align:left; padding:6px;">ID</th>
                  <th style="text-align:left; padding:6px;">Nombre</th>
                  <th style="text-align:left; padding:6px;">RFC</th>
                  <th style="text-align:left; padding:6px;">Email</th>
                  <th style="text-align:left; padding:6px;">Tel√©fono</th>
                  <th style="padding:6px;">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let c of resultados" style="border-top:1px solid #eee;">
                  <td style="padding:6px;">{{c.id}}</td>
                  <td style="padding:6px;">{{c.nombres}} {{c.apellido_paterno}} {{c.apellido_materno}}</td>
                  <td style="padding:6px;">{{c.rfc}}</td>
                  <td style="padding:6px;">{{c.email}}</td>
                  <td style="padding:6px;">{{c.telefono}}</td>
                  <td style="padding:6px; text-align:center;">
                    <button type="button" class="btn btn-secondary" (click)="seleccionarCliente(c)">Seleccionar</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div *ngIf="seleccion && resultados.length !== 1" class="info-banner" style="margin-top:10px;">
          Cliente seleccionado: <strong>#{{seleccion.id}}</strong> ‚Äî {{seleccion.nombres}} {{seleccion.apellido_paterno}} {{seleccion.apellido_materno}} ({{seleccion.rfc}})
        </div>
      </div>

      <div class="form-section" *ngIf="seleccion">
        <div class="section-header">
          <div class="section-icon"><span>üë§</span></div>
          <div class="section-title">
            <h2>Datos del Cliente</h2>
            <p>Se llenan autom√°ticamente desde el registro</p>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group"><label>Nombre</label><input type="text" [value]="seleccion.nombres + ' ' + (seleccion.apellido_paterno||'') + ' ' + (seleccion.apellido_materno||'')" readonly></div>
          <div class="form-group"><label>RFC</label><input type="text" [value]="seleccion.rfc" readonly></div>
          <div class="form-group"><label>CURP</label><input type="text" [value]="seleccion.curp" readonly></div>
          <div class="form-group"><label>Email</label><input type="text" [value]="seleccion.email" readonly></div>
          <div class="form-group"><label>Tel√©fono</label><input type="text" [value]="seleccion.telefono" readonly></div>
          <div class="form-group"><label>Estado</label><input type="text" [value]="seleccion.estado" readonly></div>
          <div class="form-group"><label>Ciudad</label><input type="text" [value]="seleccion.ciudad" readonly></div>
          <div class="form-group" style="grid-column: span 2;"><label>Direcci√≥n</label><input type="text" [value]="seleccion.direccion" readonly></div>
        </div>
      </div>

      <div class="form-section" *ngIf="seleccion">
        <div class="section-header">
          <div class="section-icon"><span>ÔøΩ</span></div>
          <div class="section-title">
            <h2>Datos del Pr√©stamo</h2>
            <p>Inter√©s base del 3.333% mensual y penalizaci√≥n de 0.4% diario por mora</p>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Tipo de pr√©stamo</label>
            <select [(ngModel)]="tipo" name="tipo_prestamo" required>
              <option value="">Seleccione...</option>
              <option value="personal">Personal</option>
              <option value="hipotecario">Hipotecario</option>
              <option value="automotriz">Automotriz</option>
              <option value="nomina">N√≥mina</option>
              <option value="pyme">PyME</option>
            </select>
          </div>
          <div class="form-group">
            <label>Monto (MXN)</label>
            <input type="number" [(ngModel)]="monto" name="monto" min="1000" step="100" required />
          </div>
          <div class="form-group">
            <label>Plazo (meses)</label>
            <select [(ngModel)]="plazoMeses" name="plazoMeses" required>
              <option [ngValue]="null">Seleccione...</option>
              <option [ngValue]="6">6</option>
              <option [ngValue]="12">12</option>
              <option [ngValue]="24">24</option>
              <option [ngValue]="36">36</option>
            </select>
          </div>
          <div class="form-group">
            <label>Pago mensual estimado</label>
            <input type="text" [value]="(cuotaMensual || 0) | number:'1.2-2'" readonly />
          </div>
          <div class="form-group">
            <label>Total a pagar (sin mora)</label>
            <input type="text" [value]="(totalBase || 0) | number:'1.2-2'" readonly />
          </div>
        </div>
        <div class="info-banner" *ngIf="monto && plazoMeses">
          Mora diaria estimada por atraso: <strong>${{ (monto * 0.004) | number:'1.2-2' }}</strong> por d√≠a
          <br>
          Si se atrasa 30 d√≠as, total estimado: <strong>${{ejemploTotalCon30DiasMora()}}</strong>
        </div>
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancelar</button>
        <button type="submit" class="btn btn-primary" [disabled]="!seleccion">Enviar Solicitud</button>
      </div>
    </form>
  </div>
</div>