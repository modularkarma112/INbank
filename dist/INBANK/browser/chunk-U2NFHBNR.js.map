{
  "version": 3,
  "sources": ["src/app/auth.service.ts"],
  "sourcesContent": ["import { Injectable, signal } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { firstValueFrom } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  \r\n  isLoggedIn = signal(false);\r\n  currentUser = signal('');\r\n\r\n  constructor(private router: Router, private http: HttpClient) {\r\n    const token = localStorage.getItem('token');\r\n    const user = localStorage.getItem('user');\r\n    if (token && user) {\r\n      this.isLoggedIn.set(true);\r\n      this.currentUser.set(JSON.parse(user)?.usuario || '');\r\n    }\r\n  }\r\n\r\n  async loginApi(usuario: string, contrasena: string): Promise<void> {\r\n    const base = 'http://3.139.254.175'; \r\n\r\n    try {\r\n      const resp = await firstValueFrom(\r\n\r\n        this.http.post<{ token: string; user: any }>(`${base}/api/auth/login`, { usuario, contrasena })\r\n      );\r\n      if (!resp?.token) throw new Error('Respuesta inválida del servidor');\r\n      localStorage.setItem('token', resp.token);\r\n      localStorage.setItem('user', JSON.stringify(resp.user));\r\n      this.isLoggedIn.set(true);\r\n      this.currentUser.set(resp.user?.usuario || usuario);\r\n      this.router.navigate(['/dashboard']);\r\n    } catch (err: any) {\r\n      if (err instanceof HttpErrorResponse) {\r\n        let msg = 'Error al iniciar sesión';\r\n        if (err.status === 0) msg = 'No se pudo conectar con el servidor.';\r\n        else if (err.status === 400) msg = 'Debes ingresar usuario y contraseña.';\r\n        else if (err.status === 401) msg = 'Usuario o contraseña incorrectos.';\r\n        else if (err.status >= 500) msg = 'Error interno del servidor. Inténtalo más tarde.';\r\n        throw new Error(msg);\r\n      }\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  logout(): void {\r\n    this.isLoggedIn.set(false);\r\n    this.currentUser.set('');\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    this.router.navigate(['/login']);\r\n    console.log('Sesión cerrada');\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return this.isLoggedIn() || !!localStorage.getItem('token');\r\n  }\r\n\r\n  getToken(): string | null {\r\n    return localStorage.getItem('token');\r\n  }\r\n}"],
  "mappings": ";;;;;;;;;;;;;AAQM,IAAO,eAAP,MAAO,aAAW;EAKtB,YAAoB,QAAwB,MAAgB;AAAxC,SAAA,SAAA;AAAwB,SAAA,OAAA;AAH5C,SAAA,aAAa,OAAO,OAAK,GAAA,YAAA,CAAA,EAAA,WAAA,aAAA,CAAA,IAAA,CAAA,CAAA;AACzB,SAAA,cAAc,OAAO,IAAE,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;AAGrB,UAAM,QAAQ,aAAa,QAAQ,OAAO;AAC1C,UAAM,OAAO,aAAa,QAAQ,MAAM;AACxC,QAAI,SAAS,MAAM;AACjB,WAAK,WAAW,IAAI,IAAI;AACxB,WAAK,YAAY,IAAI,KAAK,MAAM,IAAI,GAAG,WAAW,EAAE;IACtD;EACF;EAEA,MAAM,SAAS,SAAiB,YAAkB;AAChD,UAAM,OAAO;AAEb,QAAI;AACF,YAAM,OAAO,MAAM,eAEjB,KAAK,KAAK,KAAmC,GAAG,IAAI,mBAAmB,EAAE,SAAS,WAAU,CAAE,CAAC;AAEjG,UAAI,CAAC,MAAM;AAAO,cAAM,IAAI,MAAM,oCAAiC;AACnE,mBAAa,QAAQ,SAAS,KAAK,KAAK;AACxC,mBAAa,QAAQ,QAAQ,KAAK,UAAU,KAAK,IAAI,CAAC;AACtD,WAAK,WAAW,IAAI,IAAI;AACxB,WAAK,YAAY,IAAI,KAAK,MAAM,WAAW,OAAO;AAClD,WAAK,OAAO,SAAS,CAAC,YAAY,CAAC;IACrC,SAAS,KAAU;AACjB,UAAI,eAAe,mBAAmB;AACpC,YAAI,MAAM;AACV,YAAI,IAAI,WAAW;AAAG,gBAAM;iBACnB,IAAI,WAAW;AAAK,gBAAM;iBAC1B,IAAI,WAAW;AAAK,gBAAM;iBAC1B,IAAI,UAAU;AAAK,gBAAM;AAClC,cAAM,IAAI,MAAM,GAAG;MACrB;AACA,YAAM;IACR;EACF;EAEA,SAAM;AACJ,SAAK,WAAW,IAAI,KAAK;AACzB,SAAK,YAAY,IAAI,EAAE;AACvB,iBAAa,WAAW,OAAO;AAC/B,iBAAa,WAAW,MAAM;AAC9B,SAAK,OAAO,SAAS,CAAC,QAAQ,CAAC;AAC/B,YAAQ,IAAI,mBAAgB;EAC9B;EAEA,kBAAe;AACb,WAAO,KAAK,WAAU,KAAM,CAAC,CAAC,aAAa,QAAQ,OAAO;EAC5D;EAEA,WAAQ;AACN,WAAO,aAAa,QAAQ,OAAO;EACrC;;;mCAxDW,cAAW,mBAAA,MAAA,GAAA,mBAAA,UAAA,CAAA;AAAA;gFAAX,cAAW,SAAX,aAAW,WAAA,YAFV,OAAM,CAAA;AAEd,IAAO,cAAP;;sEAAO,aAAW,CAAA;UAHvB;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
